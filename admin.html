<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
   <div class="sidebar-toggle" onclick="toggleSidebar()">☰</div>
  <div class="sidebar" id="sidebar">
  <a href="index.html">Home</a>
  </div>
  <script>
    function toggleSidebar() {
       const sidebar = document.getElementById('sidebar');
       if (sidebar.style.left === '0px') {
         sidebar.style.left = '-240px';
       } else {
         sidebar.style.left = '0px';
       }
    }

  </script>
  <style>
    .header-tabs a.active {
      background-color: #2c5c2e;
      color: white;
    }
        .sidebar-toggle {
  font-size: 1.2rem;
  cursor: pointer;
  padding: 1rem;
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1001;
  background: #2c5c2e;
  color: white;
  border-radius: 6px;
}

.sidebar {
  position: fixed;
  top: 0;
  left: -240px;
  width: 220px;
  height: 100%;
  background-color: #1e3d2f;
  color: white;
  padding-top: 4rem;
  transition: 0.3s ease-in-out;
  z-index: 1000;
  box-shadow: 2px 0 8px rgba(0,0,0,0.2);
}

.sidebar a {
  display: block;
  color: white;
  padding: 14px 18px;
  text-decoration: none;
  font-weight: bold;
}

.sidebar a:hover {
  background-color: #2c5c2e;
}
.header-tabs {
  background-color: #f2f2f2;
  padding: 10px 0;
  box-shadow: inset 0 -1px 0 #ddd;
}

.header-tabs ul {
  display: flex;
  justify-content: center;
  gap: 1.5rem;
  list-style: none;
  margin: 0;
  padding: 0;
  flex-wrap: wrap;
}

.header-tabs li a {
  padding: 10px 18px;
  font-weight: 600;
  text-decoration: none;
  color: #2c5c2e;
  border-bottom: 3px solid transparent;
  transition: 0.3s ease;
}

.header-tabs li a:hover {
  border-bottom: 3px solid #2c5c2e;
}

.header-tabs li a.active {
  color: #1e3d2f;
  border-bottom: 3px solid #1e3d2f;
  font-weight: 700;
}

  </style>
<nav class="header-tabs">
  <ul>
    <li><a href="admin.html" data-page="admin.html">Admin Panel</a></li>
    <li><a href="slider.html" data-page="slider.html">Sliders</a></li>
    <li><a href="order.html" data-page="order.html">Orders</a></li>
    <li><a href="orderhistory.html" data-page="orderhistory.html">Order History</a></li>
    <li><a href="coupons.html" data-page="orderhistory.html">Cupons</a></li>
    <li><a href="advertisevideo.html" data-page="orderhistory.html">Advertise Videos</a></li>
    <li><a href="admin-review.html" data-page="orderhistory.html">Review Approvals</a></li>
    <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
</div>

  </ul>
</nav>

  <script>
  const currentPage = window.location.pathname.split("/").pop();
  const tabLinks = document.querySelectorAll(".header-tabs a");

  tabLinks.forEach(link => {
    if (link.dataset.page === currentPage) {
      link.classList.add("active");
    }
  });
</script>
  <title>Verdantra Admin CMS</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }
    h2 {
      color: #2c5c2e;
    }
    form, .product-list {
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 2rem;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #2c5c2e;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      cursor: pointer;
    }
    .product-card {
      border: 1px solid #ccc;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
    }
    .product-img {
      max-width: 120px;
      max-height: 120px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .product-actions button {
      margin: 5px;
    }
    .size-list {
      margin-top: 10px;
      background: #f9f9f9;
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h2>Add Product</h2>
  <form id="productForm">
    <input type="text" id="parentName" placeholder="Parent Product Name" required>
    <input type="text" id="desc" placeholder="Description">
    <textarea id="benefits" placeholder="Product Benefits (one per line)"></textarea>
    <input type="text" id="category" placeholder="Category">
    <input type="text" id="imageUrl" placeholder="Main Image URL">
    <textarea id="imageUrls" placeholder="Additional Image URLs (comma-separated)"></textarea>
    <input type="text" id="videoUrl" placeholder="Video Embed URL">
    <input type="number" step="0.1" id="rating" placeholder="Rating">
    <label><input type="checkbox" id="outOfStock"> Out of Stock</label>
    <h3>Sizes</h3>
    <div id="sizesWrapper"></div>
    <button type="button" onclick="addSizeRow()">Add Size</button><br><br>
    <button type="submit">Save Product</button>
    <button type="button" onclick="cancelEdit()" id="cancelEditBtn" style="display:none">Cancel</button>
  </form>




  <h2>Existing Products</h2>
  <div id="productList" class="product-list"></div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDkZ5j7BDsf6u6f2fphTL0Au6tQ3NDTdIk",
      authDomain: "verdantra-grows.firebaseapp.com",
      projectId: "verdantra-grows",
      storageBucket: "verdantra-grows.appspot.com",
      messagingSenderId: "642225222429",
      appId: "1:642225222429:web:b32000eda4a1195a45a7f4"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let editMode = false;
    let editProductId = null;

    function addSizeRow(size = {}) {
      const row = document.createElement('div');
      row.className = 'sizeRow';
      row.innerHTML = `
        <input type="text" placeholder="Size Label" value="${size.label || ''}" class="sizeLabel" required>
        <input type="number" placeholder="Price" value="${size.price || ''}" class="sizePrice" required>
        <input type="number" placeholder="Stock" value="${size.stock || ''}" class="sizeStock" required>
        <button type="button" onclick="this.parentElement.remove()">Remove</button>
      `;
      document.getElementById('sizesWrapper').appendChild(row);
    }

    function renderSizes(sizes = []) {
      document.getElementById('sizesWrapper').innerHTML = '';
      sizes.forEach(s => addSizeRow(s));
    }

    document.getElementById('productForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const sizes = [...document.querySelectorAll('.sizeRow')].map(row => ({
        label: row.querySelector('.sizeLabel').value,
        price: parseFloat(row.querySelector('.sizePrice').value),
        stock: parseInt(row.querySelector('.sizeStock').value)
      }));

      const data = {
        parentName: document.getElementById('parentName').value,
        desc: document.getElementById('desc').value,
        benefits: document.getElementById('benefits').value.split('\n').map(b => b.trim()).filter(b => b),
        category: document.getElementById('category').value,
        imageUrl: document.getElementById('imageUrl').value,
        imageUrls: document.getElementById('imageUrls').value.split(',').map(s => s.trim()),
        videoUrl: document.getElementById('videoUrl').value,
        rating: parseFloat(document.getElementById('rating').value),
        outOfStock: document.getElementById('outOfStock').checked,
        sizes,
        created: new Date()
      };

      if (editMode && editProductId) {
        await db.collection("products").doc(editProductId).update(data);
        editMode = false;
        editProductId = null;
        document.getElementById('cancelEditBtn').style.display = 'none';
      } else {
        const docRef = await db.collection("products").add(data);
        await db.collection("products").doc(docRef.id).update({ productId: docRef.id });
      }

      document.getElementById('productForm').reset();
      document.getElementById('sizesWrapper').innerHTML = '';
      loadProducts();
    });

   async function saveCoupon() {

    }



    function cancelEdit() {
      editMode = false;
      editProductId = null;
      document.getElementById('productForm').reset();
      document.getElementById('sizesWrapper').innerHTML = '';
      document.getElementById('cancelEditBtn').style.display = 'none';
    }

    async function loadProducts() {
      const productList = document.getElementById('productList');
      productList.innerHTML = '';
      const snapshot = await db.collection("products").orderBy("created", "desc").get();
      snapshot.forEach(doc => {
        const p = doc.data();
        const div = document.createElement('div');
        div.className = 'product-card';
        div.innerHTML = `
          <img src="${p.imageUrl}" class="product-img">
          <div><strong>${p.parentName}</strong> (${p.category})<br>${p.desc}</div>
          ${p.benefits?.length ? `<div style="margin: 0.5rem 0;"><strong>Benefits:</strong><ul>${p.benefits.map(b => `<li>${b}</li>`).join('')}</ul></div>` : ''}
          <div><strong>Rating:</strong> ${p.rating || '-'}<br><strong>Out of Stock:</strong> ${p.outOfStock ? 'Yes' : 'No'}</div>
          <div class="size-list">
            <strong>Sizes:</strong><br>
            ${p.sizes.map(s => `${s.label} - ₹${s.price} (${s.stock} in stock)`).join('<br>')}
          </div>
          <div class="product-actions">
            <button onclick='editProduct(${JSON.stringify(doc.id)}, ${JSON.stringify(p)})'>Edit</button>
            <button onclick='deleteProduct("${doc.id}")'>Delete</button>
          </div>
        `;
        productList.appendChild(div);
      });
    }

    function editProduct(id, data) {
      editMode = true;
      editProductId = id;
      document.getElementById('cancelEditBtn').style.display = 'inline-block';
      document.getElementById('parentName').value = data.parentName;
      document.getElementById('desc').value = data.desc;
      document.getElementById('benefits').value = (data.benefits || []).join('\n');
      document.getElementById('category').value = data.category;
      document.getElementById('imageUrl').value = data.imageUrl;
      document.getElementById('imageUrls').value = data.imageUrls.join(', ');
      document.getElementById('videoUrl').value = data.videoUrl;
      document.getElementById('rating').value = data.rating;
      document.getElementById('outOfStock').checked = data.outOfStock;
      renderSizes(data.sizes);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function deleteProduct(id) {
      if (confirm("Delete this product?")) {
        await db.collection("products").doc(id).delete();
        loadProducts();
      }
    }

    loadProducts();
    addSizeRow();
  </script>
</body>
</html>
